# クリーンアーキテクチャ遵守
1. 基本原則
依存関係は必ず 外側 → 内側 の一方向のみ。
ビジネスルールは技術に依存しない。DB/フレームワーク/UIの詳細を持ち込まない。
内側が抽象（ポート）を定義し、外側がその実装を提供する（DIP）。
各層の境界では データ変換（DTO/ビューモデル） を行い、内側のエンティティを漏らさない。

---

2. レイヤ構成と責務
Entities（ドメインモデル）
ビジネスルール、不変条件、値オブジェクト、エンティティ。
外部依存の型やI/Oは絶対に使わない。
Use Cases（ユースケース層）
アプリ固有のビジネスルール（操作手順、ワークフロー、権限チェック）。
入力ポートを介して呼ばれ、出力ポートやプレゼンタポートを呼び出す。
DBや外部APIには直接アクセスせず、必ず抽象ポート経由で行う。
Interface Adapters（インターフェースアダプタ）
入出力の変換を担当。
Repository 実装、Controller、Presenter など。
内側のモデルと外側の形式をマッピングするのみで、ビジネスロジックは書かない。
Frameworks & Drivers（外縁）
Webフレームワーク、DB実装、UI、外部サービスとの接続など。
設定・起動処理・インフラ制御のみを配置。

---

3. ポートとデータ契約
入力ポート：ユースケースの操作定義（例: CreateOrder）。
出力ポート：ユースケースが利用する外部機能の抽象（例: OrderRepository, PaymentGateway）。
プレゼンタポート：ユースケースの結果を表示用形式に変換する契約。
DTO/レスポンスモデル：境界を越えるデータ構造。内側のエンティティを直接外に出さない。

---

4. コーディング規則
ユースケースは1ユースケース = 1トランザクション境界とする。
バリデーション：
入力形式/型チェックは外側（Controller）。
ビジネスルール検証は内側（Entities/UseCase）。
ログ・トランザクション・監査処理はアダプタやデコレータで扱い、ユースケース本体に混在させない。
エラー処理：ユースケースは意味的な失敗を返却し、HTTPコード変換は外側で行う。

---

5. ディレクトリ構成（抽象例）
/domain
  /entity        # エンティティ、値オブジェクト
  /policy        # 不変条件やビジネスルール
/application
  /usecase       # ユースケース実装
  /port          # 入出力/プレゼンタの抽象
  /dto           # 入出力データ契約
/interface
  /controller    # 入力アダプタ
  /presenter     # 出力アダプタ
  /gateway       # 外部サービス/DBアダプタ
/infrastructure
  /framework     # WebFW, DI, ORM 設定
  /persistence   # DB実装
  /external      # 外部APIクライアント
  /config        # 設定・起動処理

---

6. テスト戦略
ドメイン層テスト：Entities/Policies を外部依存なしで検証。
ユースケース層テスト：出力ポートをモック化し、ユースケースの分岐・ルールを検証。
アダプタ層テスト：Repository や Controller の実装を対象に。
統合/E2Eテスト：シナリオごとの全体動作確認。